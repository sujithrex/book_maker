{% load book_filters %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="author" content="{{ project.author }}">
    <title>{{ project.title }}</title>
    <style>
        @page {
            size: 110mm 170mm;
            margin: 0;
        }

        @page :left {
            margin: 20mm 10mm 12mm 15mm;
            @top-left { content: counter(page) }
            @top-right { content: string(heading); font-variant: small-caps }
        }

        @page :right {
            margin: 20mm 15mm 12mm 10mm;
            @top-left { content: string(heading); font-variant: small-caps }
            @top-right { content: counter(page) }
        }

        @page frontmatter {
            margin: 0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Title Page */
        .title-page {
            page: frontmatter;
            break-after: page;
            height: 170mm;
            width: 110mm;
            position: relative;
        }

        .title-wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90mm;
            text-align: center;
        }

        .title-page h1 {
            font-size: 24pt;
            line-height: 1.3;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 10mm;
            letter-spacing: 0.5mm;
        }

        .title-page .subtitle {
            font-size: 14pt;
            font-style: italic;
            line-height: 1.4;
            color: #333;
        }

        .title-page .author {
            position: absolute;
            bottom: 30mm;
            left: 0;
            width: 110mm;
            font-size: 16pt;
            text-align: center;
        }

        /* Copyright Page */
        .copyright-page {
            page: frontmatter;
            break-after: page;
            padding: 40mm 15mm 20mm;
            font-size: 9pt;
            line-height: 1.5;
        }

        .copyright-page > div {
            margin-bottom: 8mm;
        }

        .copyright-page .section-title {
            font-weight: bold;
            margin-bottom: 2mm;
        }

        /* Keep existing TOC and chapter styles */
        /* Table of contents */
        #contents {
            page: clean;
            margin-top: 4em;
        }

        #contents p {
            margin: 2em 0;
            text-indent: 0;
            font-weight: bold;
            text-align: left;
        }

        #contents ul {
            list-style: none;
            margin: 1em 0;
            padding: 0;
            width: 100%;
        }

        #contents li {
            margin-bottom: 0.5em;
            text-indent: 2em;
            width: 100%;
            display: flex;
            align-items: baseline;
        }

        #contents a {
            color: inherit;
            text-decoration: none;
            display: flex;
            width: 100%;
            justify-content: space-between;
            align-items: baseline;
        }

        #contents a::after {
            content: leader('.') ' ' target-counter(attr(href), page);
            margin-left: 0.5em;
        }

        #contents a::before {
            content: target-text(attr(href));
        }

        /* Chapter styles */
        .chapitre {
            break-before: right;
            margin-top: 4em;
            width: 100%;
        }

        .chapitre h2 {
            font-size: 1.2em;
            font-variant: small-caps;
            font-weight: bold;
            margin: 0 0 3em;
            page: clean;
            string-set: heading content();
            text-align: right;
            width: 100%;
        }

        .chapitre .chapter-content {
            text-align: justify;
            text-justify: inter-word;
            width: 100%;
        }

        .chapitre .chapter-content p {
            text-align: justify;
            text-justify: inter-word;
            text-indent: 2em;
            margin-bottom: 1em;
            width: 100%;
            hyphens: auto;
            -webkit-hyphens: auto;
            -ms-hyphens: auto;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <!-- Title Page -->
    <section class="title-page">
        <div class="title-wrapper">
            <h1>{{ project.title }}</h1>
            {% if project.subtitle %}
            <div class="subtitle">{{ project.subtitle }}</div>
            {% endif %}
        </div>
        <div class="author">{{ project.author }}</div>
    </section>

    <!-- Copyright Page -->
    <section class="copyright-page">
        <div class="copyright-section">
            <div class="section-title">Copyright Information</div>
            Copyright Â© {% if project.year %}{{ project.year }}{% else %}{% now "Y" %}{% endif %} by {{ project.author }}
            <br>All rights reserved.
        </div>

        <div class="rights-section">
            No part of this publication may be reproduced, distributed, or transmitted in any form or by any means without prior written permission of the publisher.
        </div>

        {% if project.isbn or project.publication_date or project.edition %}
        <div class="publication-section">
            <div class="section-title">Publication Details</div>
            {% if project.isbn %}ISBN: {{ project.isbn }}<br>{% endif %}
            {% if project.edition %}Edition: {{ project.edition }}<br>{% endif %}
            {% if project.publication_date %}Publication Date: {{ project.publication_date }}<br>{% endif %}
        </div>
        {% endif %}

        {% if project.publisher or project.publisher_address %}
        <div class="publisher-section">
            <div class="section-title">Publisher Information</div>
            {% if project.publisher %}{{ project.publisher }}<br>{% endif %}
            {% if project.publisher_address %}{{ project.publisher_address }}<br>{% endif %}
        </div>
        {% endif %}

        {% if project.designer or project.editor or project.cover_designer %}
        <div class="credits-section">
            <div class="section-title">Credits</div>
            {% if project.designer %}Book Design: {{ project.designer }}<br>{% endif %}
            {% if project.editor %}Editor: {{ project.editor }}<br>{% endif %}
            {% if project.cover_designer %}Cover Design: {{ project.cover_designer }}<br>{% endif %}
        </div>
        {% endif %}

        {% if project.printing_info %}
        <div class="printing-section">
            <div class="section-title">Printing Information</div>
            {{ project.printing_info }}
        </div>
        {% endif %}
    </section>

    <!-- Table of Contents (Original Style) -->
    <section id="contents">
        <p>Table of Contents</p>
        <ul>
            {% for chapter in chapters %}
            <li><a href="#chapter-{{ chapter.id }}-h2"></a></li>
            {% endfor %}
        </ul>
    </section>

    <!-- Chapters (Original Style) -->
    {% for chapter in chapters %}
    <section id="chapter-{{ chapter.id }}" class="chapitre">
        <h2 id="chapter-{{ chapter.id }}-h2">{{ chapter.title }}</h2>
        <div class="chapter-content">
            {{ chapter.content|safe }}
        </div>
    </section>
    {% endfor %}
</body>
</html> 